<style>
    .clickable:hover {
        cursor: pointer;
    }

    #result-table {
        margin-top: 2em;
        margin-bottom: 2em;
    }
</style>

<table id="result-table" style="width: 100%">
    <colgroup>
        <col span="1" style="width: 6%">
        <col span="1" style="width: 6%">
        <col span="1" style="width: 78%">
        <col span="1" style="width: 10%">
    </colgroup>
    <tr>
        <th></th>
        <th>Test result</th>
        <th>Description</th>
        <th>Result</th>
    </tr>
    {% for test in include.testRun.tests %}
    {% include result_row.html test=test depth=1 %}
    {% endfor %}
</table>

<script>
    // Let compound tests expand their children.
    $(".clickable").click(function () {
        var parent = $(this).parent();
        var parent_depth = parent.data("depth");
        var tests = $(this).data("rows");

        parent.nextAll().each(function () {
            if (tests > 0) {
                if ($(this).data("depth") === parent_depth + 1) {
                    $(this).toggle(200);
                    tests--;
                }
            }
        });
        $(this).children().toggleClass("fa-plus-square").toggleClass("fa-minus-square");
    });
    // Common settings of all tooltips.
    var common_tooltip = {
        position: {
            my: "left center",
            at: "right center"
        },
        // Let the tooltip stay up if the mouse is over it.
        show: null,
        hide: {
            effect: ""
        },
        close: function( event, ui ) {
            ui.tooltip.hover(
                function () {
                    $(this).stop(true).fadeTo(400, 1);
                },
                function () {
                    $(this).fadeOut("400", function(){ $(this).remove(); })
                }
            );
        }
    };
    $(".sw-tooltip").tooltip($.extend({}, common_tooltip, {
        items: ".sw-tooltip",
        content: function () {
            var natural_sw = $(this).data("natural-sw").replace(/'/g, "");
            var sws = $(this).data("sws").replace(/'/g, "").split(",");
            sws = sws.map(function (t) { return "0x" + parseInt(t).toString(16); }).join(" ");
            var nat_sws = $("<span></span>").text("0x" + parseInt(natural_sw).toString(16));
            var ectester_sws = $("<span></span>").text(sws);
            var natural_label = $("<b>Natural SW:</b>");
            var sws_label = $("<b>SWs:</b>");
            return natural_label.add(nat_sws).add($("<br/>")).add(sws_label).add(ectester_sws);
        }
    }));
    $(".cause-tooltip").tooltip($.extend({}, common_tooltip, {
        items: ".cause-tooltip",
        content: function () {
            return $(this).data("cause");
        }
    }));
    $(".kpg-tooltip").tooltip($.extend({}, common_tooltip, {
    	items: ".kpg-tooltip",
    	content: function () {
    		var pubkey = $(this).data("pubkey");
    		var privkey = $(this).data("privkey");
    		var pubkey_label = $("<b>Public key:</b>");
    		var privkey_label = $("<b>Private key:</b>");
    		return pubkey_label.add($("<span></span>").text(pubkey)).add($("<br/>")).add(privkey_label).add($("<span></span>").text(privkey));
    	}
    }));
    $(".ka-tooltip").tooltip($.extend({}, common_tooltip, {
    	items: ".ka-tooltip",
    	content: function () {
    		var pubkey = $(this).data("pubkey");
    		var privkey = $(this).data("privkey");
    		var secret = $(this).data("secret");
    		var pubkey_label = $("<b>Public key:</b>");
    		var privkey_label = $("<b>Private key:</b>");
    		var secret_label = $("<b>Derived secret:</b>");
    		return pubkey_label.add($("<span></span>").text(pubkey)).add($("<br/>")).add(privkey_label).add($("<span></span>").text(privkey)).add($("<br/>")).add(secret_label).add($("<span></span>").text(secret));
    	}
    }));
    $(".sig-tooltip").tooltip($.extend({}, common_tooltip, {
    	items: ".sig-tooltip",
    	content: function () {
    		var sig = $(this).data("signature");
    		var sig_label = $("<b>Signature:</b>");
    		return sig_label.add($("<span></span>").text(sig));
    	}
    }));
</script>