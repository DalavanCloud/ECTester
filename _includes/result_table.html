<style>
    .clickable:hover,#expand-all:hover,#collapse-all:hover {
        cursor: pointer;
    }

    #result-table {
	    margin-top: -120px;
        margin-bottom: 2em;
    }

    #expand-all {
    	position: sticky;
    	top: 100px;
    	transform: translateX(-150px);
    }
    #collapse-all {
    	position: sticky;
    	top: 150px;
    	transform: translateX(-150px);
    }
    @media screen and (max-width: 64em) {
		#expand-all, #collapse-all {
			position: relative;
			top: 0;
			transform: none;
		}
		#result-table {
			margin-top: 1em;
		}
    }
</style>


<span id="expand-all" class="btn body-btn">Expand all</span><br/>
<span id="collapse-all" class="btn body-btn">Collapse all</span>


<table id="result-table" style="width: 100%;">
    <colgroup>
        <col span="1" style="width: 6%">
        <col span="1" style="width: 6%">
        <col span="1" style="width: 78%">
        <col span="1" style="width: 10%">
    </colgroup>
    <tr>
        <th title="Dropdown"><i class="fa fa-list"></i></th>
        <th>Test result</th>
        <th>Description</th>
        <th>Result</th>
    </tr>
    {% for test in include.testRun.tests %}
    {% include result_row.html test=test depth=1 %}
    {% endfor %}
</table>

<script>
	function expand(elem, all, timeout) {
		var parent = elem.parent();
		var parent_depth = parent.data("depth");
		var objs = $();
		parent.nextAll().each(function () {
				var depth = $(this).data("depth");
				if ((all && depth > parent_depth + 1) || depth == parent_depth + 1) {
					objs = objs.add($(this));
					var clickable = $(this).children(":first");
					if (all && clickable.hasClass("clickable") && !clickable.data("toggled")) {
						clickable.data("toggled", true);
						clickable.children().toggleClass("fa-plus-square").toggleClass("fa-minus-square");
					}
				} else if (depth == parent_depth) {
					return false;
				}
				return true;
		});
        elem.children(":first").removeClass("fa-plus-square").addClass("fa-minus-square");
        elem.data("toggled", true);
		objs.show(timeout);
	}

	function collapse(elem, timeout) {
		var parent = elem.parent();
		var parent_depth = parent.data("depth");
		var objs = $();
		parent.nextAll().each(function () {
				var depth = $(this).data("depth");
				if (depth >= parent_depth + 1) {
					objs = objs.add($(this));
					var clickable = $(this).children(":first");
					if (clickable.data("toggled")) {
						clickable.data("toggled", false);
						clickable.children().toggleClass("fa-plus-square").toggleClass("fa-minus-square");
					}
				} else if (depth <= parent_depth) {
					return false;
				}
				return true;
		});
        elem.children(":first").removeClass("fa-minus-square").addClass("fa-plus-square");
        elem.data("toggled", false);
		objs.hide(timeout);
	}

	$(".clickable").click(function (e) {
		if ($(this).data("toggled")) {
			collapse($(this), 200);
		} else {
			expand($(this), e.ctrlKey, 200);
		}
	});

	$("#expand-all").click(function () {
		$(".clickable").filter(function (i, e) {
			return $(e).parent().data("depth") == 1;
		}).each(function (i, e) {
			expand($(e), true, 200);
		});
	});

	$("#collapse-all").click(function () {
		$(".clickable").filter(function (i, e) {
			return $(e).parent().data("depth") == 1 && $(e).data("toggled") == true;
		}).each(function (i, e) {
			collapse($(e), 200);
		});
	});

    // Common settings of all tooltips.
    var common_tooltip = {
        position: {
            my: "left center",
            at: "right center"
        },
        // Let the tooltip stay up if the mouse is over it.
        show: null,
        hide: {
            effect: ""
        },
        close: function( event, ui ) {
            ui.tooltip.hover(
                function () {
                    $(this).stop(true).fadeTo(400, 1);
                },
                function () {
                    $(this).fadeOut("400", function(){ $(this).remove(); })
                }
            );
        }
    };
    $(".sw-tooltip").tooltip($.extend({}, common_tooltip, {
        items: ".sw-tooltip",
        content: function () {
            var natural_sw = $(this).data("natural-sw").replace(/'/g, "");
            var sws = $(this).data("sws").replace(/'/g, "").split(",");
            sws = sws.map(function (t) { return "0x" + parseInt(t).toString(16); }).join(" ");
            var nat_sws = $("<span></span>").text("0x" + parseInt(natural_sw).toString(16));
            var ectester_sws = $("<span></span>").text(sws);
            var natural_label = $("<b>Natural SW:</b>");
            var sws_label = $("<b>SWs:</b>");
            return natural_label.add(nat_sws).add($("<br/>")).add(sws_label).add(ectester_sws);
        }
    }));
    $(".cause-tooltip").tooltip($.extend({}, common_tooltip, {
        items: ".cause-tooltip",
        content: function () {
            return $(this).data("cause");
        }
    }));
    $(".kpg-tooltip").tooltip($.extend({}, common_tooltip, {
    	items: ".kpg-tooltip",
    	content: function () {
    		var pubkey = $(this).data("pubkey");
    		var privkey = $(this).data("privkey");
    		var pubkey_label = $("<b>Public key:</b>");
    		var privkey_label = $("<b>Private key:</b>");
    		return pubkey_label.add($("<span></span>").text(pubkey)).add($("<br/>")).add(privkey_label).add($("<span></span>").text(privkey));
    	}
    }));
    $(".ka-tooltip").tooltip($.extend({}, common_tooltip, {
    	items: ".ka-tooltip",
    	content: function () {
    		var pubkey = $(this).data("pubkey");
    		var privkey = $(this).data("privkey");
    		var secret = $(this).data("secret");
    		var pubkey_label = $("<b>Public key:</b>");
    		var privkey_label = $("<b>Private key:</b>");
    		var secret_label = $("<b>Derived secret:</b>");
    		return pubkey_label.add($("<span></span>").text(pubkey)).add($("<br/>")).add(privkey_label).add($("<span></span>").text(privkey)).add($("<br/>")).add(secret_label).add($("<span></span>").text(secret));
    	}
    }));
    $(".sig-tooltip").tooltip($.extend({}, common_tooltip, {
    	items: ".sig-tooltip",
    	content: function () {
    		var sig = $(this).data("signature");
    		var sig_label = $("<b>Signature:</b>");
    		return sig_label.add($("<span></span>").text(sig));
    	}
    }));
</script>